<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gallery Panel â€” Single File</title>

  <!-- Fonts -->
  <link href="https://fonts.cdnfonts.com/css/thegoodmonolith" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/pp-neue-montreal" rel="stylesheet">

  <style>
    @import url("https://fonts.cdnfonts.com/css/thegoodmonolith");

    /* Using the hosted CSS for PP Neue Montreal so it loads cleanly */
    :root {
  --baseWidth: 290px;
  --smallHeight: 200px;
  --largeHeight: 200px;

  --itemGap: 5px;
  --bufferZone: 1.0;

  --borderRadius: 16px;

  --itemVignetteSize: 200px;

  --pageVignetteStrength: 1.0;
  --pageVignetteSize: 500px;

  --overlayOpacity: 0.9;
  --overlayEaseDuration: 0.8s;

  --hoverScale: 1.05;
  --expandedScale: 0.40;
  --dragEase: 0.07s;
  --momentumFactor: 0.20; /* typical default, update if you want */
  --zoomDuration: 0.6s;
}


    * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

    body {
      font-family: "PP Neue Montreal", -apple-system, BlinkMacSystemFont, Segoe UI, Inter, Roboto, Helvetica, Arial, sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
      position: relative;
    }

    /* Animated noise effect */
    body::before {
      content: "";
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: transparent url("http://assets.iceable.com/img/noise-transparent.png") repeat 0 0;
      background-size: 300px 300px;
      animation: noise-animation 0.3s steps(5) infinite;
      opacity: 0.9;
      will-change: transform;
      z-index: 100;
      pointer-events: none;
    }
    @keyframes noise-animation {
      0% { transform: translate(0, 0); }
      10% { transform: translate(-2%, -3%); }
      20% { transform: translate(-4%, 2%); }
      30% { transform: translate(2%, -4%); }
      40% { transform: translate(-2%, 5%); }
      50% { transform: translate(-4%, 2%); }
      60% { transform: translate(3%, 0); }
      70% { transform: translate(0, 3%); }
      80% { transform: translate(-3%, 0); }
      90% { transform: translate(2%, 2%); }
      100% { transform: translate(1%, 0); }
    }

    /* Global type & links */
    a {
      position: relative;
      cursor: pointer;
      color: var(--color-text);
      padding: 0;
      display: inline-block;
      z-index: 1;
      text-decoration: none;
      font-size: var(--font-size-base);
      opacity: 1;
      transition: color var(--transition-medium);
      font-weight: 700;
    }
    a::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 0; height: 100%;
      background-color: var(--color-text);
      z-index: -1;
      transition: width 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    a:hover::after, .links span:hover::after { width: 100%; }
    a:hover, .links span:hover { color: #000; mix-blend-mode: difference; opacity: 1; }

    p {
      display: block;
      text-decoration: none;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.01rem;
      -webkit-font-smoothing: antialiased;
    }
    ul { list-style: none; }
    h3 { font-size: 14px; margin-bottom: var(--spacing-base); font-weight: 600; }

    /* Header & Footer grid */
    .header, .footer {
      position: absolute;
      left: 0; width: 100vw;
      padding: 1.5rem;
      z-index: 10000;
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      column-gap: var(--spacing-base);
      pointer-events: none; /* allow canvas drag underneath; re-enable on inner links */
    }
    .header a, .footer a { pointer-events: auto; }

    .header { top: 0; }
    .footer { bottom: 0; }

    /* Grid column assignments */
    .nav-section { grid-column: 1 / span 3; }
    .values-section { grid-column: 5 / span 2; }
    .location-section { grid-column: 7 / span 2; }
    .contact-section { grid-column: 9 / span 2; }
    .social-section { grid-column: 11 / span 2; text-align: right; }

    /* Bottom bar */
    .coordinates-section { grid-column: 1 / span 3; font-family: "TheGoodMonolith", monospace; }
    .links-section { grid-column: 5 / span 4; text-align: center; display: flex; justify-content: center; align-items: center; gap: var(--spacing-base); }
    .info-section { grid-column: 9 / span 4; text-align: right; }
    .footer p { font-family: "TheGoodMonolith", monospace; }

    /* Key hint styling */
    .key-hint {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0 5px; border: 1px solid var(--color-text);
      border-radius: 3px; font-size: 12px; margin: 0 3px;
      min-width: 20px; height: 20px;
    }

    /* ===== LOGO COMPONENT ===== */
    .logo-container { margin-bottom: var(--spacing-md); display: block; width: 3rem; height: 1.5rem; position: relative; }
    .logo-circles { position: relative; width: 100%; height: 100%; }
    .circle {
      position: absolute; border-radius: 50%;
      transition: transform var(--transition-medium);
      width: 1.4rem; height: 1.4rem; background-color: var(--color-text);
      top: 50%;
    }
    .circle-1 { left: 0; transform: translate(0, -50%); }
    .circle-2 { left: 0.8rem; transform: translate(0, -50%); mix-blend-mode: exclusion; }
    .logo-container:hover .circle-1 { transform: translate(-0.5rem, -50%); }
    .logo-container:hover .circle-2 { transform: translate(0.5rem, -50%); }

    /* Canvas container */
    .container { position: relative; width: 100vw; height: 100vh; overflow: hidden; cursor: grab; }
    .canvas { position: absolute; will-change: transform; }

    .item {
      position: absolute; overflow: hidden; background-color: #000; cursor: pointer;
      border-radius: var(--border-radius, 0px);
    }
    .item-image-container { width: 100%; height: 100%; overflow: hidden; position: relative; }
    .item-image-container::after {
      content: ""; position: absolute; inset: 0; pointer-events: none;
      box-shadow: inset 0 0 var(--vignette-size, 0px) rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
    .item img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; transition: transform 0.3s ease; }
    .item:hover img { transform: scale(var(--hover-scale, 1.05)); }

    .item-caption { position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px; z-index: 2; }
    .item-name {
      font-family: "PP Neue Montreal", sans-serif; color: #fff; font-size: 8px; font-weight: 500;
      text-transform: uppercase; letter-spacing: -0.03em; margin-bottom: 2px; position: relative; overflow: hidden; height: 16px;opacity:0;
    }
    .item-name .word { position: relative; display: inline-block; will-change: transform; }
    .item-number {
      font-family: "TheGoodMonolith", monospace; color: #888; font-size: 10px; font-weight: 400;
      position: relative; overflow: hidden; height: 14px;
    }
    .item-number .char { position: relative; display: inline-block; will-change: transform; }

    /* Project title above everything */
    .project-title {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 100%; text-align: center; pointer-events: none; z-index: 10002;
    }
    .project-title p { position: relative; height: 42px; color: #fff; clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%); overflow: hidden; }
    .project-title p .word {
      position: relative; display: inline-block; font-family: "PP Neue Montreal", sans-serif; font-size: 36px;
      letter-spacing: -0.03em; text-transform: uppercase; transform: translateY(0%); will-change: transform;
    }

    /* Expanded */
    .expanded-item {
      position: fixed; z-index: 10000; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background-color: #000; overflow: hidden; cursor: pointer; border-radius: var(--border-radius, 0px);
    }
    .expanded-item img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

    .overlay {
      position: fixed; inset: 0; background-color: #000; pointer-events: none; opacity: 0; z-index: 9999;
    }
    .overlay.active { pointer-events: auto; }

    /* Page vignette effect layers */
    .page-vignette-container { position: fixed; inset: 0; pointer-events: none; z-index: 9998; }
    .page-vignette { position: absolute; inset: 0; box-shadow: inset 0 0 var(--page-vignette-size, 0px) var(--page-vignette-color); }
    .page-vignette-strong { position: absolute; inset: 0; box-shadow: inset 0 0 var(--page-vignette-strong-size, 0px) var(--page-vignette-strong-color); }
    .page-vignette-extreme { position: absolute; inset: 0; box-shadow: inset 0 0 var(--page-vignette-extreme-size, 0px) var(--page-vignette-extreme-color); }

    /* Tweakpane z-index helpers */
    .tp-dfwv { z-index: 10000 !important; }
    .tp-rotv { opacity: 0.5 !important; }
    .tp-rotv.tp-rotv-expanded { opacity: 1 !important; }
    .tp-rotv.tp-rotv-collapsed { opacity: 0.7 !important; }

    /* Caption animation clone */
    .caption-clone { position: fixed; z-index: 10002; }

    /* Make header/footer a bit more touch friendly on small screens */
    @media (max-width: 900px) {
      .header, .footer { grid-template-columns: repeat(6, 1fr); row-gap: .75rem; }
      .nav-section { grid-column: 1 / span 3; }
      .values-section { grid-column: 4 / span 3; }
      .location-section { grid-column: 1 / span 2; }
      .contact-section { grid-column: 3 / span 2; }
      .social-section { grid-column: 5 / span 2; text-align: right; }
      .coordinates-section { grid-column: 1 / span 3; }
      .links-section { grid-column: 3 / span 2; }
      .info-section { grid-column: 5 / span 2; }
      .project-title p .word { font-size: 28px; }
    }


    /* Hide all gallery labels/titles completely */
.item-caption,
.project-title { 
  display: none !important;
}

  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div class="nav-section">
      <div class="logo-container">
        <div class="header">
          <h3>ZCKGRT</h3>
        </div>
      </div>
    </div>



    <div class="social-section">
      <ul>
        <li><a href="https://zackgort.com">portfolio</a></li>
        <li><a href="https://zackgort.com/resume">resume</a></li>
        <li><a href="https://linkedin.com/in/zackgort">LinkedIn</a></li>
        <li><a href="https://soundcloud.com/zackgort">My Music</a></li>        
      </ul>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <div class="coordinates-section">
      <p>All Photos Herein Belong to Zack Gort</p>
    </div>

    <div class="info-section">
      <p><a href="https://soundcloud.com/zackgort">My music on SoundCloud</a></p>
    </div>
  </div>

  <!-- CANVAS -->
  <div class="container">
    <div class="canvas" id="canvas"></div>
    <div class="overlay" id="overlay"></div>
  </div>

  <div class="project-title"><p></p></div>

  <!-- Page vignette effects -->
  <div class="page-vignette-container">
    <div class="page-vignette"></div>
    <div class="page-vignette-strong"></div>
    <div class="page-vignette-extreme"></div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.7/dist/CustomEase.min.js"></script>
  <script src="https://unpkg.com/split-type"></script>

  <!-- App (module so we can import Tweakpane) -->
  <script type="module">
    import { Pane } from "https://cdn.skypack.dev/tweakpane@4.0.4";
    window.Pane = Pane;

    // Register GSAP plugins
    gsap.registerPlugin(CustomEase);
    CustomEase.create("hop", "0.9, 0, 0.1, 1");


// Project titles
const items = [
  " "," "," "," "," ",
  " "," "," "," "," ",
  " "," "," "," "," ",
  " "," "," "," "," "
];

// Image URLs
const imageUrls = [
  "https://i.ibb.co/HLbthyBP/603985613b870e6cd6c49a29-IMG-3457.jpg",
  "https://i.ibb.co/TzBw2tf/603d6216612acc7c7e54bef2-IMG-1158.jpg",
  "https://i.ibb.co/Q3g94Qvm/603d10120fba838e599b6b5e-IMG-1563.jpg",
  "https://i.ibb.co/FLqq86nk/603d6207dcd0225713fe1549-IMG-4484.jpg",
  "https://i.ibb.co/jkbWhf7c/603d1185cafcb2591f42b1ad-IMG-3932.jpg",
  "https://i.ibb.co/kVLJncPv/603d1185b8ec32082f451ba9-IMG-3882.jpg",
  "https://i.ibb.co/g0gQP0D/603d138e1d5ed053b509992a-IMG-5199.jpg",
  "https://i.ibb.co/DD6wrNzS/603d102dae26b192aef6ab4a-IMG-3023.jpg",
  "https://i.ibb.co/mC5TTsXX/603d100d889053cc334ee5fc-IMG-2083.jpg",
  "https://i.ibb.co/HTR23qbc/603d61b96ca6f0c336165b6e-DSC09310.jpg",
  "https://i.ibb.co/mVVMY8HQ/603d8d7a3a6df470a4a661a1-DSC00726.jpg",
  "https://i.ibb.co/pjh1ftD4/603d0bb2331da47ee88db089-DSC02085.jpg",
  "https://i.ibb.co/q32VwbxG/603d0b5635e8053bc120bec7-DSC09034.jpg",
  "https://i.ibb.co/WWktTDQ5/603d0b8b038105ae6904872a-DSC08334.jpg",
  "https://i.ibb.co/B57brGpH/603d0b8abf1990616037cc35-ZAX03810.jpg",
  "https://i.ibb.co/KkHpvXt/603b3890dcd3ab104d67d405-ZAX01233-2.jpg",
  "https://i.ibb.co/HfVqtzzn/603afe37ba16f8f9174cf501-IMG-1878.jpg",
  "https://i.ibb.co/DHp56d4c/603a967ad03490104c2aaefe-ZAX01042-2.jpg",
  "https://i.ibb.co/Qvnn64Kb/603a967ac64cec73069e2454-ZAX09877.jpg",
  "https://i.ibb.co/vxkSqfr5/603a967a5dc3e982f571b744-ZAX00968.jpg",
  "https://i.ibb.co/xt9M8KB9/603a95ee83ba30ff4ac9bc6a-DSC00423-1.jpg",
  "https://i.ibb.co/Ldw6P2Lb/603a95edd03490eb412aaedc-DSC08676.jpg",
  "https://i.ibb.co/Vc7dTGcw/603a93f06a41f45766a3361a-DSC09212.jpg",
  "https://i.ibb.co/d4QzChqk/603a95ed29478f4bc91875b5-DSC08933.jpg",
  "https://i.ibb.co/ch9YMGNW/603a93f0e815e830d1783e07-IMG-2033.jpg",
  "https://i.ibb.co/JWb6r4zD/603a93efdfd184c21ef2d238-IMG-3352.jpg",
  "https://i.ibb.co/HmmhS33/603a93eef8754819192222f7-DSC09720.jpg",
  "https://i.ibb.co/mrWgT1QH/603a93eedce047078935438a-IMG-5686.jpg",
  "https://i.ibb.co/Dgm1cLry/603a93eedcd3ab4b2e64fcbc-IMG-4204.jpg",
  "https://i.ibb.co/tpvRzKWF/603a93eea83b1aab7a98c35b-DSC08228.jpg",
  "https://i.ibb.co/S4DSwGfN/603a93eddcd3ab104d64fcbb-ZAX09767.jpg"
];

// (Optional) If counts differ, generate fallback titles to match image count:
const displayTitles = imageUrls.map((_, i) => items[i] ?? `Project ${i + 1}`);


    const container = document.querySelector(".container");
    const canvas = document.getElementById("canvas");
    const overlay = document.getElementById("overlay");
    const projectTitleElement = document.querySelector(".project-title p");

    // Settings for Tweakpane
    const settings = {
      baseWidth: 400,
      smallHeight: 330,
      largeHeight: 500,
      itemGap: 65,
      hoverScale: 1.05,
      expandedScale: 0.4,
      dragEase: 0.075,
      momentumFactor: 200,
      bufferZone: 3,
      borderRadius: 0,
      vignetteSize: 0,

      // Page vignette settings (simplified)
      vignetteStrength: 0.7,
      vignetteSize: 200,

      // Overlay
      overlayOpacity: 0.9,
      overlayEaseDuration: 0.8,

      // Durations
      zoomDuration: 0.6
    };

    // Derived layout
    let itemSizes = [
      { width: settings.baseWidth, height: settings.smallHeight },
      { width: settings.baseWidth, height: settings.largeHeight }
    ];
    let itemGap = settings.itemGap;
    let columns = 4;
    const itemCount = items.length;

    let cellWidth = settings.baseWidth + settings.itemGap;
    let cellHeight = Math.max(settings.smallHeight, settings.largeHeight) + settings.itemGap;

    // State
    let isDragging = false;
    let startX, startY;
    let targetX = 0, targetY = 0;
    let currentX = 0, currentY = 0;
    let dragVelocityX = 0, dragVelocityY = 0;
    let lastDragTime = 0;
    let mouseHasMoved = false;
    let visibleItems = new Set();
    let lastUpdateTime = 0;
    let lastX = 0, lastY = 0;
    let isExpanded = false;
    let activeItem = null;
    let activeItemId = null;
    let canDrag = true;
    let originalPosition = null;
    let expandedItem = null;
    let overlayAnimation = null;
    let titleSplit = null;
    let paneInstance = null;

// --------- Defaults (replaces the Tweakpane UI) ----------
function initTweakpane() {
  // no UI; just lock in the desired defaults at startup
  paneInstance = null;

  const d = {
    // Item Sizes
    baseWidth: 300,
    smallHeight: 200,
    largeHeight: 200,

    // Layout
    itemGap: 5,
    bufferZone: 1.0,

    // Style
    borderRadius: 16,

    // Vignettes
    itemVignetteSize: 200,
    pageVignetteStrength: 1.0,
    pageVignetteSize: 500,

    // Overlay Animation
    overlayOpacity: 0.90,
    overlayEaseDuration: 0.8,

    // (Optional) Animation â€” keep if your code uses these
    hoverScale: 1.05,
    expandedScale: 0.40,
    dragEase: 0.07,
    momentumFactor: 0.20,
    zoomDuration: 0.6,
  };

  // ---- Apply to your settings object (back-compat with your helpers) ----
  settings.baseWidth   = d.baseWidth;
  settings.smallHeight = d.smallHeight;
  settings.largeHeight = d.largeHeight;

  settings.itemGap     = d.itemGap;
  settings.bufferZone  = d.bufferZone;

  settings.borderRadius = d.borderRadius;

  // If your code previously used a single "vignetteSize" for items,
  // keep it in sync with the item vignette helper:
  settings.itemVignetteSize = d.itemVignetteSize;
  settings.vignetteSize     = d.itemVignetteSize; // back-compat for updateVignetteSize()

  // Page vignette values (used by updatePageVignette)
  settings.vignetteStrength = d.pageVignetteStrength;
  settings.pageVignetteSize = d.pageVignetteSize;

  // Overlay
  settings.overlayOpacity      = d.overlayOpacity;
  settings.overlayEaseDuration = d.overlayEaseDuration;

  // Animation (only if your code uses them)
  settings.hoverScale     = d.hoverScale;
  settings.expandedScale  = d.expandedScale;
  settings.dragEase       = d.dragEase;
  settings.momentumFactor = d.momentumFactor;
  settings.zoomDuration   = d.zoomDuration;

  // ---- Apply CSS custom properties (if your styles read from :root) ----
  const root = document.documentElement.style;
  root.setProperty('--baseWidth', d.baseWidth + 'px');
  root.setProperty('--smallHeight', d.smallHeight + 'px');
  root.setProperty('--largeHeight', d.largeHeight + 'px');

  root.setProperty('--itemGap', d.itemGap + 'px');
  root.setProperty('--bufferZone', String(d.bufferZone));

  root.setProperty('--borderRadius', d.borderRadius + 'px');

  root.setProperty('--itemVignetteSize', d.itemVignetteSize + 'px');
  root.setProperty('--pageVignetteStrength', String(d.pageVignetteStrength));
  root.setProperty('--pageVignetteSize', d.pageVignetteSize + 'px');

  root.setProperty('--overlayOpacity', String(d.overlayOpacity));
  root.setProperty('--overlayEaseDuration', d.overlayEaseDuration + 's');

  // Optional animation vars if you use them in CSS
  root.setProperty('--hoverScale', String(d.hoverScale));
  root.setProperty('--expandedScale', String(d.expandedScale));
  root.setProperty('--dragEase', d.dragEase + 's');
  root.setProperty('--momentumFactor', String(d.momentumFactor));
  root.setProperty('--zoomDuration', d.zoomDuration + 's');

  // ---- Run your existing applicators once on load ----
  if (typeof updateSettings === 'function')        updateSettings();
  if (typeof updateBorderRadius === 'function')    updateBorderRadius();
  if (typeof updateVignetteSize === 'function')    updateVignetteSize();   // item vignette
  if (typeof updatePageVignette === 'function')    updatePageVignette();   // page vignette
  if (typeof updateHoverScale === 'function')      updateHoverScale();

  // Reset view like the old "Reset View" button
  if (typeof targetX !== 'undefined') targetX = 0;
  if (typeof targetY !== 'undefined') targetY = 0;

  // NOTE: We intentionally do not attach any keydown handlers
  // and we do not create window.Pane() â€” the panel is fully removed.
}

    function togglePaneVisibility() {
      if (!paneInstance) return;
      const el = paneInstance.element;
      el.style.display = (el.style.display === "none") ? "" : "none";
    }

    // --------- Style updaters ----------
    function updateBorderRadius() {
      document.documentElement.style.setProperty("--border-radius", `${settings.borderRadius}px`);
    }
    function updateVignetteSize() {
      document.documentElement.style.setProperty("--vignette-size", `${settings.vignetteSize}px`);
    }
    function updatePageVignette() {
      const strength = settings.vignetteStrength;
      const size = settings.vignetteSize;

      const regularOpacity = strength * 0.7;
      const regularSize = size * 1.5;
      document.documentElement.style.setProperty("--page-vignette-size", `${regularSize}px`);
      document.documentElement.style.setProperty("--page-vignette-color", `rgba(0,0,0,${regularOpacity})`);

      const strongOpacity = strength * 0.85;
      const strongSize = size * 0.75;
      document.documentElement.style.setProperty("--page-vignette-strong-size", `${strongSize}px`);
      document.documentElement.style.setProperty("--page-vignette-strong-color", `rgba(0,0,0,${strongOpacity})`);

      const extremeOpacity = strength;
      const extremeSize = size * 0.4;
      document.documentElement.style.setProperty("--page-vignette-extreme-size", `${extremeSize}px`);
      document.documentElement.style.setProperty("--page-vignette-extreme-color", `rgba(0,0,0,${extremeOpacity})`);
    }
    function updateHoverScale() {
      document.documentElement.style.setProperty("--hover-scale", settings.hoverScale);
      document.querySelectorAll(".item img").forEach((img) => { img.style.transition = "transform 0.3s ease"; });
    }

    // Rebuild on settings change
    function updateSettings() {
      itemSizes = [
        { width: settings.baseWidth, height: settings.smallHeight },
        { width: settings.baseWidth, height: settings.largeHeight }
      ];
      itemGap = settings.itemGap;
      columns = 4;
      cellWidth = settings.baseWidth + settings.itemGap;
      cellHeight = Math.max(settings.smallHeight, settings.largeHeight) + settings.itemGap;

      visibleItems.forEach((id) => {
        const el = document.getElementById(id);
        if (el && el.parentNode === canvas) canvas.removeChild(el);
      });
      visibleItems.clear();
      updateVisibleItems();

      updateBorderRadius();
      updateVignetteSize();
      updateHoverScale();
      updatePageVignette();
    }

    // --------- Title anims ----------
    function setAndAnimateTitle(title) {
      if (titleSplit) titleSplit.revert();
      projectTitleElement.textContent = title;
      titleSplit = new SplitType(projectTitleElement, { types: "words" });
      gsap.set(titleSplit.words, { y: "100%" });
    }
    function animateTitleIn() {
      gsap.fromTo(titleSplit.words, { y: "100%", opacity: 0 }, { y: "0%", opacity: 1, duration: 1, stagger: 0.1, ease: "power3.out" });
    }
    function animateTitleOut() {
      gsap.to(titleSplit.words, { y: "-100%", opacity: 0, duration: 1, stagger: 0.1, ease: "power3.out" });
    }

    // --------- Overlay anims ----------
    function animateOverlayIn() {
      if (overlayAnimation) overlayAnimation.kill();
      overlayAnimation = gsap.to(overlay, {
        opacity: settings.overlayOpacity,
        duration: settings.overlayEaseDuration,
        ease: "power2.inOut",
        overwrite: true
      });
    }
    function animateOverlayOut() {
      if (overlayAnimation) overlayAnimation.kill();
      overlayAnimation = gsap.to(overlay, {
        opacity: 0,
        duration: settings.overlayEaseDuration,
        ease: "power2.inOut"
      });
    }

    // --------- Grid helpers ----------
    function getItemSize(row, col) {
      const idx = Math.abs((row * columns + col) % itemSizes.length);
      return itemSizes[idx];
    }
    function getItemId(col, row) { return `${col},${row}`; }
    function getItemPosition(col, row) {
      return { x: col * cellWidth, y: row * cellHeight };
    }

    function updateVisibleItems() {
      const buffer = settings.bufferZone;
      const viewWidth = window.innerWidth * (1 + buffer);
      const viewHeight = window.innerHeight * (1 + buffer);

      const startCol = Math.floor((-currentX - viewWidth / 2) / cellWidth);
      const endCol = Math.ceil((-currentX + viewWidth * 1.5) / cellWidth);
      const startRow = Math.floor((-currentY - viewHeight / 2) / cellHeight);
      const endRow = Math.ceil((-currentY + viewHeight * 1.5) / cellHeight);

      const currentItems = new Set();

      for (let row = startRow; row <= endRow; row++) {
        for (let col = startCol; col <= endCol; col++) {
          const itemId = getItemId(col, row);
          currentItems.add(itemId);
          if (visibleItems.has(itemId)) continue;
          if (activeItemId === itemId && isExpanded) continue;

          const size = getItemSize(row, col);
          const pos = getItemPosition(col, row);

          const item = document.createElement("div");
          item.className = "item";
          item.id = itemId;
          item.style.width = `${size.width}px`;
          item.style.height = `${size.height}px`;
          item.style.left = `${pos.x}px`;
          item.style.top = `${pos.y}px`;
          item.dataset.col = col;
          item.dataset.row = row;
          item.dataset.width = size.width;
          item.dataset.height = size.height;

          const itemNum = Math.abs((row * columns + col) % itemCount);

          const imageContainer = document.createElement("div");
          imageContainer.className = "item-image-container";

          const img = document.createElement("img");
          img.src = imageUrls[itemNum % imageUrls.length];
          img.alt = `Image ${itemNum + 1}`;
          imageContainer.appendChild(img);
          item.appendChild(imageContainer);

          const caption = document.createElement("div");
          caption.className = "item-caption";

          const name = document.createElement("div");
          name.className = "item-name";
          name.textContent = items[itemNum];
          caption.appendChild(name);

          const number = document.createElement("div");
          number.className = "item-number";
          number.textContent = `#${(itemNum + 1).toString().padStart(5, "0")}`;
          caption.appendChild(number);

          item.appendChild(caption);

          item.addEventListener("click", (e) => {
            if (mouseHasMoved || isDragging) return;
            handleItemClick(item, itemNum);
          });

          canvas.appendChild(item);
          visibleItems.add(itemId);
        }
      }

      // Remove outside items
      visibleItems.forEach((id) => {
        if (!currentItems.has(id) || (activeItemId === id && isExpanded)) {
          const el = document.getElementById(id);
          if (el && el.parentNode === canvas) canvas.removeChild(el);
          visibleItems.delete(id);
        }
      });
    }

    function handleItemClick(item, itemIndex) {
      if (isExpanded) {
        if (expandedItem) closeExpandedItem();
      } else {
        expandItem(item, itemIndex);
      }
    }

    function expandItem(item, itemIndex) {
      isExpanded = true;
      activeItem = item;
      activeItemId = item.id;
      canDrag = false;
      container.style.cursor = "auto";

      const imgSrc = item.querySelector("img").src;
      const titleIndex = itemIndex % items.length;
      const itemWidth = parseInt(item.dataset.width);
      const itemHeight = parseInt(item.dataset.height);

      setAndAnimateTitle(items[titleIndex]);

      // Caption clone to animate out
      const nameEl = item.querySelector(".item-name");
      const numberEl = item.querySelector(".item-number");
      const nameText = nameEl.textContent;
      const numberText = numberEl.textContent;

      const captionClone = item.querySelector(".item-caption").cloneNode(true);
      captionClone.classList.add("caption-clone");
      const nameClone = captionClone.querySelector(".item-name");
      const numberClone = captionClone.querySelector(".item-number");

      const nameCloneSplit = new SplitType(nameClone, { types: "words" });
      const numberCloneSplit = new SplitType(numberClone, { types: "words" });

      const captionRect = item.querySelector(".item-caption").getBoundingClientRect();
      captionClone.style.left = `${captionRect.left}px`;
      captionClone.style.bottom = `${window.innerHeight - captionRect.bottom}px`;
      captionClone.style.width = `${captionRect.width}px`;
      captionClone.style.zIndex = "10002";
      document.body.appendChild(captionClone);
      item.querySelector(".item-caption").style.opacity = "0";

      gsap.to(nameCloneSplit.words, { y: "100%", opacity: 0, duration: 0.6, stagger: 0.03, ease: "power3.in" });
      gsap.to(numberCloneSplit.words, {
        y: "100%", opacity: 0, duration: 0.6, stagger: 0.02, delay: 0.05, ease: "power3.in",
        onComplete: () => { if (captionClone.parentNode) document.body.removeChild(captionClone); }
      });

      const rect = item.getBoundingClientRect();
      originalPosition = { id: item.id, rect, imgSrc, width: itemWidth, height: itemHeight, nameText, numberText };

      overlay.classList.add("active");
      animateOverlayIn();

      expandedItem = document.createElement("div");
      expandedItem.className = "expanded-item";
      expandedItem.style.width = `${itemWidth}px`;
      expandedItem.style.height = `${itemHeight}px`;
      expandedItem.style.zIndex = "10000";
      expandedItem.style.borderRadius = `var(--border-radius, 0px)`;

      const bigImg = document.createElement("img");
      bigImg.src = imgSrc;
      expandedItem.appendChild(bigImg);
      expandedItem.addEventListener("click", closeExpandedItem);
      document.body.appendChild(expandedItem);

      document.querySelectorAll(".item").forEach((el) => {
        if (el !== activeItem) {
          gsap.to(el, { opacity: 0, duration: settings.overlayEaseDuration, ease: "power2.inOut" });
        }
      });

      const viewportWidth = window.innerWidth;
      const targetWidth = viewportWidth * settings.expandedScale;
      const aspect = itemHeight / itemWidth;
      const targetHeight = targetWidth * aspect;

      gsap.delayedCall(0.5, animateTitleIn);
      gsap.fromTo(
        expandedItem,
        { width: itemWidth, height: itemHeight, x: rect.left + itemWidth/2 - window.innerWidth/2, y: rect.top + itemHeight/2 - window.innerHeight/2 },
        { width: targetWidth, height: targetHeight, x: 0, y: 0, duration: settings.zoomDuration, ease: "hop" }
      );
    }

    function closeExpandedItem() {
      if (!expandedItem || !originalPosition) return;

      animateTitleOut();
      animateOverlayOut();

      document.querySelectorAll(".item").forEach((el) => {
        if (el.id !== activeItemId) {
          gsap.to(el, { opacity: 1, duration: settings.overlayEaseDuration, delay: 0.3, ease: "power2.inOut" });
        }
      });

      const originalItem = document.getElementById(activeItemId);
      if (originalItem) {
        const nameEl = originalItem.querySelector(".item-name");
        const numberEl = originalItem.querySelector(".item-number");
        nameEl.textContent = originalPosition.nameText;
        numberEl.textContent = originalPosition.numberText;
        originalItem.querySelector(".item-caption").style.opacity = "0";
      }

      const originalRect = originalPosition.rect;
      const originalWidth = originalPosition.width;
      const originalHeight = originalPosition.height;

      gsap.to(expandedItem, {
        width: originalWidth, height: originalHeight,
        x: originalRect.left + originalWidth/2 - window.innerWidth/2,
        y: originalRect.top + originalHeight/2 - window.innerHeight/2,
        duration: settings.zoomDuration, ease: "hop",
        onComplete: () => {
          if (originalItem) {
            const captionEl = originalItem.querySelector(".item-caption");
            const captionClone = document.createElement("div");
            captionClone.className = "caption-clone";
            captionClone.innerHTML = captionEl.innerHTML;

            const cr = captionEl.getBoundingClientRect();
            captionClone.style.position = "fixed";
            captionClone.style.left = `${cr.left}px`;
            captionClone.style.bottom = `${window.innerHeight - cr.bottom}px`;
            captionClone.style.width = `${cr.width}px`;
            captionClone.style.padding = "10px";
            captionClone.style.zIndex = "10002";
            document.body.appendChild(captionClone);

            const nameClone = captionClone.querySelector(".item-name");
            const numberClone = captionClone.querySelector(".item-number");
            nameClone.style.overflow = "hidden";
            numberClone.style.overflow = "hidden";

            const nameSplit = new SplitType(nameClone, { types: "words" });
            const numberSplit = new SplitType(numberClone, { types: "words" });

            gsap.set([nameSplit.words, numberSplit.words], { y: "100%", opacity: 0 });

            gsap.to(nameSplit.words, { y: "0%", opacity: 1, duration: 0.7, stagger: 0.03, ease: "power3.out" });
            gsap.to(numberSplit.words, {
              y: "0%", opacity: 1, duration: 0.7, stagger: 0.02, delay: 0.05, ease: "power3.out",
              onComplete: () => {
                captionEl.style.opacity = "1";
                if (captionClone.parentNode) document.body.removeChild(captionClone);
              }
            });
          }

          if (expandedItem && expandedItem.parentNode) document.body.removeChild(expandedItem);
          if (originalItem) originalItem.style.visibility = "visible";

          expandedItem = null;
          isExpanded = false;
          activeItem = null;
          originalPosition = null;
          activeItemId = null;
          canDrag = true;
          container.style.cursor = "grab";
          dragVelocityX = 0;
          dragVelocityY = 0;
          overlay.classList.remove("active");
        }
      });
    }

    // --------- Main loop ----------
    function animate() {
      if (canDrag) {
        const ease = settings.dragEase;
        currentX += (targetX - currentX) * ease;
        currentY += (targetY - currentY) * ease;
        canvas.style.transform = `translate(${currentX}px, ${currentY}px)`;

        const now = Date.now();
        const distMoved = Math.hypot(currentX - lastX, currentY - lastY);
        if (distMoved > 100 || now - lastUpdateTime > 120) {
          updateVisibleItems();
          lastX = currentX; lastY = currentY; lastUpdateTime = now;
        }
      }
      requestAnimationFrame(animate);
    }

    // --------- Input handlers ----------
    container.addEventListener("mousedown", (e) => {
      if (!canDrag) return;
      isDragging = true; mouseHasMoved = false;
      startX = e.clientX; startY = e.clientY;
      container.style.cursor = "grabbing";
    });
    window.addEventListener("mousemove", (e) => {
      if (!isDragging || !canDrag) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      if (Math.abs(dx) > 5 || Math.abs(dy) > 5) mouseHasMoved = true;

      const now = Date.now();
      const dt = Math.max(10, now - lastDragTime);
      lastDragTime = now;
      dragVelocityX = dx / dt; dragVelocityY = dy / dt;

      targetX += dx; targetY += dy;
      startX = e.clientX; startY = e.clientY;
    });
    window.addEventListener("mouseup", () => {
      if (!isDragging) return;
      isDragging = false;
      if (canDrag) {
        container.style.cursor = "grab";
        if (Math.abs(dragVelocityX) > 0.1 || Math.abs(dragVelocityY) > 0.1) {
          const m = settings.momentumFactor;
          targetX += dragVelocityX * m;
          targetY += dragVelocityY * m;
        }
      }
    });

    overlay.addEventListener("click", () => { if (isExpanded) closeExpandedItem(); });

    container.addEventListener("touchstart", (e) => {
      if (!canDrag) return;
      isDragging = true; mouseHasMoved = false;
      startX = e.touches[0].clientX; startY = e.touches[0].clientY;
    }, { passive: true });

    window.addEventListener("touchmove", (e) => {
      if (!isDragging || !canDrag) return;
      const dx = e.touches[0].clientX - startX;
      const dy = e.touches[0].clientY - startY;
      if (Math.abs(dx) > 5 || Math.abs(dy) > 5) mouseHasMoved = true;
      targetX += dx; targetY += dy;
      startX = e.touches[0].clientX; startY = e.touches[0].clientY;
    }, { passive: true });

    window.addEventListener("touchend", () => { isDragging = false; });

    window.addEventListener("resize", () => {
      if (isExpanded && expandedItem) {
        const vw = window.innerWidth;
        const targetWidth = vw * settings.expandedScale;
        const aspect = originalPosition.height / originalPosition.width;
        const targetHeight = targetWidth * aspect;
        gsap.to(expandedItem, { width: targetWidth, height: targetHeight, duration: 0.3, ease: "power2.out" });
      } else {
        updateVisibleItems();
      }
    });

    // --------- Boot ---------
    function initializeStyles() {
      updateBorderRadius();
      updateVignetteSize();
      updateHoverScale();
      updatePageVignette();
    }

    initializeStyles();
    updateVisibleItems();
    animate();
    setTimeout(initTweakpane, 500);
  </script>
</body>
</html>
